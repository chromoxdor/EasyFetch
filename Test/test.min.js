var jsonPath,nNr,nP,nP2,nIV,iIV,unitNr,unitNr1,navOpen,manNav,gesVal,iO,html,fJ,firstRun=1,hasParams=1,isittime=1,unitName="",html2="",htmlold="",shouldShowOld=!1,selectionData={},efcArray=[],cD=[],jStats=!1,fetchAbort=new AbortController;const cmD="control?cmd=",diV="</div>";var coloumnSet,myJson2,tsX,tsY,teX,teY,tsTime,baseUrl="",runonce2=!0,hiddenOverride=!1,isMain=!0;async function fetchJson(e){try{for(const e of document.styleSheets)for(const t of e.cssRules)if(t.conditionText?.includes("prefers-color-scheme")){const e=document.cookie.includes("Col=1");t.media.mediaText=`(prefers-color-scheme: ${e?"light":"dark"})`}}catch(e){}if(!isittime)return;!0===runonce2&&await getEfcData();let t=new URLSearchParams(window.location.search);myParam=t.get("unit"),"reboot"==t.get("cmd")&&(window.location.href=window.location.origin+"/tools?cmd=reboot"),null==myParam&&(hasParams=0),someoneEn=0;let n,s=window.efc?"?showpluginstats=1":"";jsonPath||(jsonPath="/json"),fetchAbort=new AbortController;try{const t=await getUrl(jsonPath+(jStats?s:""),{controller:fetchAbort,signal:fetchAbort.signal});if(fetchAbort.signal.aborted)return;if(n=await t.json(),unitName=n.WiFi.Hostname,unitNr=n.System["Unit Number"],window.configMode||getEfcUnitData(unitName),JSON.stringify(selectionData).includes('"chart":1')&&!jStats)return jStats=!0,void newFJ(e)}catch(e){if("AbortError"===e.name)return;if(e.toString().includes("double-quoted"))return jStats=!1,void newFJ()}if(!isittime||!n)return;html="";let i="",o="",l="",a='<div class="bigNum">',r='<div class="valuesBig" style="font-weight:bold;text-align:left;">';sysInfo=n?.System;let c=[{label:"Sysinfo of",value:unitName},{label:"Local Time",value:sysInfo["Local Time"]},{label:"Uptime",value:minutesToDhm(sysInfo.Uptime)},{label:"Load",value:`${sysInfo.Load}%`},sysInfo["Internal Temperature"]&&{label:"Temp",value:`${sysInfo["Internal Temperature"]}Â°C`,style:`color: ${sysInfo["Internal Temperature"]>55?"red":"inherit"};`},{label:"Free Ram",value:sysInfo["Free RAM"]},{label:"Free Stack",value:sysInfo["Free Stack"]},{label:"IP Address",value:n.WiFi["IP Address"]},{label:"RSSI",value:`${n.WiFi.RSSI} dBm`},{label:"Build",value:sysInfo.Build},{label:"Eco Mode",value:"true"===sysInfo["CPU Eco Mode"]?"on":"off"}].filter(Boolean).map((e=>`\n                <div class="syspair">\n                    <div>${e.label}:</div>\n                    <div style="${e.style||""}">${e.value}</div>\n                </div>\n            `)).join(""),[d,m]=n.System["Local Time"].split(" ");m=m.split(":").slice(0,-1).join(":");let[u,v,$]=d.split("-");if(n.Sensors.length||hasParams){for(const e of n.Sensors){const{TaskNumber:t,TaskDeviceNumber:s,TaskName:c,TaskDeviceGPIO1:d,PluginStats:h}=e;if(h){const e=cD.find((e=>e.device===c));e?e.chart=h:cD.push({device:c,chart:h})}sensorName=c,deviceName=c,taskEnabled=e.TaskEnabled.toString();const[,f]=getComputedStyle(document.body).backgroundColor.match(/\d+/g);tBGS=selectionData?.S?.SBC&&"#000000"!==selectionData?.S?.SBC?`background:${selectionData?.S?.SBC}${"0"===f?"80":""}`:"";var g=changeNN(sensorName);const p='sensorset clickables" onclick="playSound(3000), ',N=`<div id="${sensorName}" class="sensors" style="font-weight:bold;">${g}</div>`;exC=[87,38,41,42].includes(s),exC2=!e.Type?.includes("Display");let y=!hiddenOverride&&1===selectionData[t]?.A?.hide;if("true"===taskEnabled&&!y&&!exC&&exC2&&!hasParams){const g=selectionData[t]?.A?.order||"0",h=selectionData[t]?.A?.chart||0;let b=`efc:${deviceName}=${s},${t}`;if(h&&window.efc&&(html2+=`<div order="${g}" id="${b},1A" class="sensorset chart" style="height:150px; padding:0;" ><canvas id="${c}chart"></canvas></div>`),e.TaskValues){someoneEn=1;let S=!1,T=!1,E=!0;for(const I of e.TaskValues){const{ValueNumber:e,Value:w,Name:L,NrDecimals:D}=I;let k=`${b},${e}`,x=selectionData?.[t]?.[e],C=selectionData[t]?.A?.val;tBG=selectionData[t]?.A?.color&&"#000000"!==selectionData[t].A.color?`background:${selectionData[t].A.color}${"0"===f?"80":""}`:"";let B=x?.val||"",A=x?.unit||"",P=`<span style="background:none;padding-left: 2px;">${A}</span>`,U=1===x?.noI?"noI":"",V=x?.order||"0";const M=x?.sendTo,[F="",O=""]=("string"==typeof M?M.split(","):[])||[];if(y=!hiddenOverride&&1===x?.hide,[slMin,slMax,slStep]=x?.range?x.range.split(","):"thSlider"===B?[5,35,1]:[0,1024,1],sensorName=C&&"none"!==C&&"chart"!==C?C:B&&"none"!==B?B:c,T||B&&!["","none","bigVS"].includes(B)&&"bigVal"!==sensorName||(T=S=!0),wasUsed=!1,num2Value="number"==typeof w?w.toFixed(D):w,itemName=1===x?.noV?"":L.toString(),itemNameChanged=changeNN(itemName),bS="",1==s)if(wasUsed=!0,"btnStateC"===itemName&&w<2||1===w?bS="on":2===w&&(bS="alert"),!d||"State"!==itemName&&"iState"!==itemName)if("pState"===itemName&&d){const e=`${sensorName}?${d}`;html+=`<div order="${g}" id="${k}A" class="${bS} btnTile push sensorset" \n                                            onpointerdown="if (event.button === 0) { playSound(3000); pushClick('${e}',1); }" \n                                            onpointerup="pushClick('${e}',0)">\n                                            <div id="${sensorName}" class="sensors" style="font-weight:bold;">${sensorName}</div>\n                                        </div>`}else itemName.includes("btnState")?("ibtnState"===itemName&&(w=1==w?0:1),A&&(sensorName=`${sensorName}|${A}`),html+=`<div order="${g}" id="${k}A" id="${sensorName}" class="btnTile ${U} ${bS} ${p}buttonClick('${sensorName}', '${w}')">${N}`):wasUsed=!1;else{"iState"===itemName&&(w=1==w?0:1);const e=`${sensorName}|${d}`;html+=`<div order="${g}" id="${k}A" class="btnTile ${bS} ${p} buttonClick('${e}', '${w}')">${N}`}if(1!==s&&!y&&!sensorName.includes("bigVal"))if(33!==s&&(U="noI"),wasUsed=!0,"C"===A&&w<2||1===w?bS="on":2===w&&(bS="alert"),["dButtons","vInput","pButtons"].some((e=>c.includes(e)))&&L.includes("noVal")){(!L.includes("noValAuto")||window.innerWidth>=450&&document.cookie.includes("Two=1"))&&(html+=`<div order="${V}" class="sensorset btnTile"></div>`)}else if(sensorName.includes("dButtons")){if(w>-1){O&&getRemoteGPIOState(t,F,O,n.System["Unit Number"],e),F&&(itemName=`${itemName}&${F}G${O}`);const s="A"===F?`getNodes('${itemName}')`:`buttonClick('${itemName}')`;html+=`<div order="${V}" id="${k}" class="btnTile ${U} ${bS} ${p} ${s}"><div id="${itemName}" class="sensors ${"A"===F?"nodes":""}" style="font-weight:bold;">${itemNameChanged}</div></div>`}}else if(sensorName.includes("pButtons")&&w>-1)html+=`<div order="${V}" id="${k}" class="${bS} btnTile push sensorset" \n                                            onpointerdown="if (event.button === 0) { playSound(3000); pushClick('${itemName}',1); }" \n                                            onpointerup="if (event.button === 0) {pushClick('${itemName}',0)}">\n                                            <div id="${itemName}" class="sensors" style="font-weight:bold;">${itemNameChanged}</div>\n                                        </div>`;else if(sensorName.includes("vInput"))html+=`\n                                        <div order="${V}" id="${k}" class="sensorset clickables">\n                                            <div id="${itemName}" class="sensors" style="font-weight:bold;pointer-events:all" onclick="getInput(this.nextElementSibling.firstElementChild)">\n                                                ${itemNameChanged}\n                                            </div>\n                                            <div class="valWrap">\n                                                <input type="number" class="vInputs ${t},${e}" id="${itemName}_vI" name="${deviceName}" placeholder="${num2Value}" onkeydown="getInput(this)" onclick="getInput(this,1)">\n                                                <div class="kindInput">${P}</div>\n                                            </div>\n                                        </div>`;else if(sensorName.includes("vSlider"))num2Value=Number(num2Value).toFixed((slStep.toString().split(".")[1]||"").length),itemName="noVal"===itemName?"&nbsp;":itemName,html2+=`<div order="${V}" id="${k}" class="${U} sensorset"><input type="range" min="${slMin}" max="${slMax}" step="${slStep}" value="${num2Value}" id="${itemName}" class="slider sL ${t},${e}`,html2+=sensorName.includes("nvSlider")?` noVal"><div class="sensors" style="align-items: flex-end;"><div style="font-weight:bold;">${itemNameChanged}</div></div></div>`:`"><div class="sensors" style="align-items: flex-end;"><div style="font-weight:bold;">${itemNameChanged}</div><div class="sliderAmount" style="text-align: right;">${num2Value}${P}</div></div></div>`;else if(sensorName.includes("tSlider")){4!==D&&(itemName="For the Time slider the value must have<br>4 decimals!"),slT1=w.toFixed(4),slT2=(slT1+"").split(".")[1],slT1=Math.floor(slT1),hour1=Math.floor(slT1/60),minute1=slT1%60;const n=minute1.toString().padStart(2,"0");hour2=Math.floor(slT2/60),minute2=slT2%60;const s=minute2.toString().padStart(2,"0");itemName=changeNN(itemName);const i='<input class="slTS slTHU" type="range" min="0" max="1440" step="5" value="';html2+=`\n                                  <div order="${V}" id="${k}" class="slTimeSetWrap ${deviceName} ${t},${e}" style="font-weight:bold;">\n                                    ${itemName}\n                                    <div class="slTimeText">\n                                      <span class="hAmount1">${hour1}</span>:<span class="mAmount1">${n}</span>-\n                                      <span class="hAmount2">${hour2}</span>:<span class="mAmount2">${s}</span>\n                                    </div>\n                                    <div class="slTimeSet">\n                                      ${i}${slT1}" id="${itemName}:L">\n                                      ${i}${slT2}" id="${itemName}:R">\n                                    </div>\n                                  </div>\n                                `}else if(sensorName.includes("thSlider")){3!==D&&(itemName="For the Thermo slider the value must have<br>3 decimals!"),itemName=changeNN(itemName),slT1=w.toFixed(3),slT2=100*(slT1-Math.floor(slT1)),slT2=slT2.toFixed(1),slT1=(Math.floor(slT1)/10).toFixed(1);const n=`type="range" min="${slMin}" max="${slMax}" step="${slStep}" value="`,s=`<div class="noI" style="z-index: 2; position: absolute">${itemName}</div>`;html2+=`\n                                  <div order="${V}" id="${k}" class="slTimeSetWrap ${deviceName} ${t},${e}" style="font-weight:bold;">\n                                    ${s}\n                                    <div class="slTimeText">\n                                      <div class="even">&#9728;&#xFE0E;<span class="isT">${slT1}</span>Â°C</div>\n                                      <div class="even">&#9737;&#xFE0E;<span class="setT">${slT2}</span>Â°C</div>\n                                    </div>\n                                    <div class="slTimeSet">\n                                      <input class="slTHU thermO ${U}" ${n}${slT2}" id="setpoint">\n                                      <input class="slider noI thT" ${n}${slT1}" id="${itemName}">\n                                    </div>\n                                  </div>\n                                `}else if(sensorName.includes("nPix")){const n=["H","S","V"].includes(A.toUpperCase())?A.toUpperCase():"H";html2+=`<div order="${V}" id="${k}" class="${U} sensorset" style="padding:0;"><input type="range" max="${"H"===n?359:100}" min="0" value="${num2Value}" id="${deviceName}?${n}" class="sL npSl ${t},${e} np${n} noVal"></div>`}else wasUsed=!1;if(sensorName.includes("bigVal")){wasUsed=!0,E&&(E=!1,o+=a);let e=`<div order="${V}" id="${k}" style="${tBG}" class="bigNumWrap `;if(!y){o+=e+'">';let t=`${r}${itemName}</div><div id="`;["Clock","Uhr"].some((e=>itemName.includes(e)))?o+=`${t}clock" class="valueBig">${m}</div></div>`:["Datum"].some((e=>itemName.toLowerCase().includes(e)))?o+=`${t}date" class="valueBig">${$}.${v}</div></div>`:["Date"].some((e=>itemName.toLowerCase().includes(e)))?o+=`${t}date" class="valueBig">${v}-${$}</div></div>`:["Year","Jahr"].some((e=>itemName.toLowerCase().includes(e)))?o+=`${t}year" class="valueBig">${u}</div></div>`:itemName.includes("noVal")?o+=`${r}</div><div class="valueBig"></span></div></div>`:o+=`${r}${itemName}</div><div class="valueBig">${num2Value}${P}</div></div>`}}if(B.includes("bigVS")&&!sensorName.includes("bigVal")){l+=`<div order="${V}" id="efc:bigSingle=${s},${t},${e}" style="${tBGS}" class="bigNumWrap bigSingles `+'">',l+=y?`${r}</div><div class="valueBig"></div></div>`:`${r}${itemName}</div><div class="valueBig">${num2Value}${P}</div></div>`}wasUsed||(43==s?S&&(1===w&&(bS="on"),html+=`<div order="${g}" id="${k}A" class="btnTile ${bS} sensorset clickables" onclick="playSound(3000); splitOn(${t}); topF();">\n                                                <div class="sensors" style="font-weight:bold;">${sensorName}</div>\n                                                <div class="odd" style="font-size: 20pt;">&#x23F2;&#xFE0E;</div>\n                                            </div></div>`):"bigVal"===C||h||(S&&(i+=`<div order="${g}" id="${k}A" class="${p}buttonClick('${sensorName}')" style="${tBG}">${N}`),(!y||B.includes("bigVS")||B.includes("chart"))&&(i+=81===s?`\n                                            <div id="${k}" class="cron">\n                                                <div>${itemNameChanged}</div>\n                                                <div style="font-size: 10pt;">${w}</div>\n                                            </div>`:`\n                                            <div id="${k}" class="row">\n                                                <div class="odd">${itemNameChanged}</div>\n                                                <div class="even">${num2Value}${P}</div>\n                                            </div>`))),S=!1}html+=diV,i+=diV,o+=diV}else i+=`\n                      <div order="${g}" id="${b},1A" class="sensorset clickables" onclick="buttonClick('${sensorName}')">\n                        <div class="sensors" style="font-weight:bold;">${sensorName}</div>\n                        <div></div><div></div>\n                      </div>\n                    `,someoneEn=1,document.getElementById("sensorList").innerHTML=i}}someoneEn||hasParams||(html+='<div class="sensorset clickables" onclick="splitOn(); topF();"> <div class="sensors" style="font-weight:bold;">no tasks enabled or visible...</div>')}else html+='<div class="sensorset clickables" onclick="splitOn(); topF();"><div  class="sensors" style="font-weight:bold;">no tasks configured...</div>';if(html+=i,l){let e="";e=a+l+diV,o+=e}document.getElementById("sysInfo").innerHTML=c,document.getElementById("sensorList").innerHTML=orderFunction(html);const h=document.getElementById("allList")?.offsetWidth>400;htmlold===html2&&h===shouldShowOld||(document.getElementById("sliderList").innerHTML=orderFunction(html2),chartInstances={}),shouldShowOld=h,htmlold=html2,html2="",document.getElementById("bigNumber").innerHTML=o,firstRun&&(document.cookie.includes("Snd=")||mC("Snd"),clearTimeout(fJ),fJ=setInterval(fetchJson,2e3),unitNr1=n.System["Unit Number"],initIP="(IP unset)"===n.WiFi["IP Address"]?"192.168.4.1":n.WiFi["IP Address"],nP2=`http://${initIP}/devices`,nP=`http://${initIP}/tools`,getNodes(),longPressS(),longPressN(),addEonce(),firstRun=!1),styleU=unitNr===unitNr1?"&#8858;&#xFE0E;":"",hasParams||(document.getElementById("unitId").innerHTML=`${styleU}${unitName} <span class="numberUnit"> (${n.WiFi.RSSI})</span>`,document.getElementById("unitT").innerHTML=`${styleU}${unitName}`),e&&getNodes(void 0,void 0,"ch"),paramS(),changeCss(),resizeText(),window.efc&&cD&&makeChart(),window.configMode||longPressB()}function orderFunction(e){let t=document.createElement("div");t.innerHTML=e;let n=[...t.children];return[...n.filter((e=>(parseInt(e.getAttribute("order"))||0)>0)).sort(((e,t)=>parseInt(e.getAttribute("order"))-parseInt(t.getAttribute("order")))),...n.filter((e=>0===(parseInt(e.getAttribute("order"))||0))),...n.filter((e=>(parseInt(e.getAttribute("order"))||0)<0)).sort(((e,t)=>parseInt(t.getAttribute("order"))-parseInt(e.getAttribute("order"))))].map((e=>e.outerHTML)).join("")}async function getRemoteGPIOState(e,t,n,s,i){const o=Number(t)===unitNr1?`${cmD}SendTo,${s},'taskvalueset,${e},${i},[Plugin%23GPIO%23Pinstate%23${n}]'`:`${cmD}SendTo,${t},'SendTo,${s},"taskvalueset,${e},${i},\\[Plugin%23GPIO%23Pinstate%23${n}\\]"'`;return await getUrl(o)}function changeNN(e){return e.replace(/_/g," ").replace(/\./g,"-<br>")}function changeCss(){let e,t,n,s=" auto";document.querySelectorAll(".chart, input[type=range]").length?document.getElementById("allList").classList.remove("allExtra"):document.getElementById("allList").classList.add("allExtra");var i=document.querySelectorAll(".bigNum"),o=document.getElementById("sensorList"),l=o.getElementsByClassName("sensorset").length;let a=Math.max(...Array.from(i,(e=>e.children.length)));n=0,i.length||(n=l),4==a||n>9?(t=s+s+s+s,e=4):3==a||n>4?(t=s+s+s,e=3):2==a||n>1?(t=s+s,e=2):1==a&&l<2||n<2&&!i.length?(t=s,i.length&&i.forEach((e=>e.classList.add("bigNumOne"))),e=1):(t=s+s,e=2);let r=!1;if(widthLimit=150*e+e*(window.innerHeight/100),(window.innerWidth<widthLimit||document.cookie.includes("Two=1"))&&(r=!0,(a>1||l>1)&&(e=2,t=s+s,a=2)),i.forEach((e=>{let t=4;for(;e.children.length<a;){let n=document.createElement("div");n.className="bigNumWrap",n.setAttribute("order",t++),e.appendChild(n)}})),i.forEach((e=>{e.innerHTML=orderFunction(e.innerHTML);let t=Array.from(e.children);3===t.length&&t.forEach((e=>e.classList.add("big3")))})),r){document.querySelectorAll(".big3").forEach((e=>e.classList.add("bigSpan")))}if(o.style.setProperty("grid-template-columns",t),i.forEach((e=>{e.style.setProperty("grid-template-columns",t)})),l%e!=0&&1!=e){calcTile=e-(l-e*Math.floor(l/e));for(let e=1;e<=calcTile;e++)o.innerHTML+='<div class="sensorset"></div>'}2==e&&1==a&&document.getElementsByClassName("bigNum")[0].appendChild(Object.assign(document.createElement("div"),{className:"bigNumWrap"})),document.getElementById("sensorList").innerHTML=o.innerHTML,a=0}function paramS(){document.querySelectorAll(".slTHU").forEach((e=>{e.addEventListener("input",updateSlTS),e.addEventListener("change",sliderChTS),e.addEventListener("pointerup",(e=>{iIV=setTimeout(blurInput,1e3)}))})),document.querySelectorAll(".sL").forEach((e=>{e.addEventListener("input",updateSlider),e.addEventListener("change",sliderChange),e.addEventListener("pointerup",(e=>{iIV=setTimeout(blurInput,1e3)}))})),neoS=document.querySelectorAll(".npS"),neoS.forEach((e=>{hVal=document.getElementById(e.id.split("?")[0]+"?H")?.value,vVal=document.getElementById(e.id.split("?")[0]+"?V")?.value||20,vVal<20&&(vVal=20),e.style.backgroundImage="linear-gradient(to right, hsl(0,0%,"+vVal+"%),hsl("+hVal+",100%,50%))"})),window.efc&&addContext()}function addEonce(){document.addEventListener("touchstart",(e=>{e.touches.length>1||(tsTime=Date.now(),tsX=e.touches[0].screenX,tsY=e.touches[0].screenY)})),document.addEventListener("touchend",(e=>{if(e.changedTouches.length>1)return;const t=Date.now();teX=e.changedTouches[0].screenX,teY=e.changedTouches[0].screenY;const n=teX-tsX,s=teY-tsY,i=t-tsTime;Math.abs(n)>40&&Math.abs(s)<30&&i<300&&(n>0&&!navOpen&&openNav(),n<0&&navOpen&&closeNav())})),document.addEventListener("mousemove",(e=>{manNav||navOpen||e.clientX<10&&-280===document.getElementById("mySidenav").offsetLeft&&openNav()})),document.getElementById("mySidenav").addEventListener("mouseleave",(e=>{manNav||closeNav()})),window.efc&&createMenu()}function checkDirection(){touchtime=msTe-msTs,touchDistX=teX-tsX,touchDistY=teY-tsY,teX<tsX&&navOpen&&Math.abs(touchDistX)>40&&Math.abs(touchDistY)<30&&touchtime<250&&closeNav(),teX>tsX&&!navOpen&&Math.abs(touchDistX)>40&&Math.abs(touchDistY)<30&&touchtime<250&&openNav()}function updateSlTS(e){isittime=0;const t=e.target,n="setpoint"===t.id,s=t.closest(".slTimeSetWrap");if(n){return void(s.querySelector(".slTimeText .setT").textContent=Number(t.value).toFixed(1))}const i="L"===t.id.slice(-1)?1:2,o=s.querySelector(`.hAmount${i}`),l=s.querySelector(`.mAmount${i}`),a=Math.floor(t.value/60),r=t.value%60;o.textContent=a,l.textContent=r.toString().padStart(2,"0")}function updateSlider(e){isittime=0;const t=e.target;t.attributes.value.nodeValue;let n=t.id.split("?")[4]||"";if(!t.className.includes("noVal")){const e=t.closest("div.sensorset").querySelector(".sliderAmount");"H"===n&&(n="%");const s=t.step.includes(".")?t.step.split(".")[1].length:0,i=Number(t.value).toFixed(s)+n;e.textContent=i}if("npSl"===t.classList[1]){const e=t.id.split("?")[0],n=document.getElementById(`${e}?H`)?.value,s=document.getElementById(`${e}?S`)?.value;let i=document.getElementById(`${e}?V`)?.value||0;if(gesVal=[n,s,i],n&&s){i=Math.max(i,20);document.getElementById(`${e}?S`).style.backgroundImage=`linear-gradient(to right, hsl(0,0%,${i}%), hsl(${n},100%,50%))`}}}function sliderChTS(e){playSound(4e3);const t=e.target,n=t.parentNode.parentNode,s=n.id.match(/:(\w+)=/)[1],i=t.id.split(":")[0],o=t.id.split(":")[1],l=n.classList[2],a=(n.classList[1],e.target.value);if("setpoint"===i){const e=`taskvalueset,${l},${10*parseFloat(t.closest(".slTimeSetWrap").querySelector(".isT").textContent)+a/100}`,n=`event,${s}Event=${10*a}`;unitNr===unitNr1?(getUrl(`${cmD}${e}`),getUrl(`${cmD}${n}`)):(getUrl(`${cmD}SendTo,${nNr},"${e}"`),getUrl(`${cmD}SendTo,${nNr},"${n}"`))}else{const e="L"===o,t=document.getElementById(e?`${i}:R`:`${i}:L`).value,n=t.toString().padStart(4,"0"),s=e?`${a}.${n}`:`${t}.${a.toString().padStart(4,"0")}`,r=`taskvalueset,${l},${s}`,c=`event,${i}Event=${s}`;unitNr===unitNr1?(getUrl(`${cmD}${r}`),getUrl(`${cmD}${c}`)):(getUrl(`${cmD}SendTo,${nNr},"${r}"`),getUrl(`${cmD}SendTo,${nNr},"${c}"`))}}function sliderChange(e){playSound(4e3);const t=e.target;let n=t.value;const s="npSl"===t.classList[1],i=(t.id.match(/\?/g)||[]).length>=3||"npSl"==t.classList[1]?t.id.split("?")[0]:t.id;gesVal&&(gesVal=gesVal.filter(Boolean));const o=`taskvalueset,${t.classList[2]},${n}`,l=s?`event,${i}Event=${gesVal}`:`event,${i}Event=${n}`;unitNr===unitNr1?(getUrl(`${cmD}${o}`),getUrl(`${cmD}${l}`)):(getUrl(`${cmD}SendTo,${nNr},"${o}"`),getUrl(`${cmD}SendTo,${nNr},"${l}"`))}function buttonClick(e,t){if(e.includes("&")){const[t,n]=e.split("&"),[s,i]=n.split("G"),o=i&&!i.endsWith("L");getUrl(unitNr==s?o?`${cmD}GPIOToggle,${i}`:`${cmD}"event,${t}Event"`:o?`${cmD}SendTo,${s},"GPIOToggle,${i}"`:`${cmD}SendTo,${s},"event,${t}Event"`)}else if(e.includes("|")){const[n,s]=e.split("|");unitNr===unitNr1?(getUrl(`${cmD}gpio,${s},${1-t}`),getUrl(`${cmD}event,${n}Event`)):(getUrl(`${cmD}SendTo,${nNr},"gpio,${s},${1-t}"`),getUrl(`${cmD}SendTo,${nNr},"event,${n}Event"`))}else{const t=`event,${e}Event`;getUrl(unitNr===unitNr1?`${cmD}"${t}"`:`${cmD}SendTo,${nNr},"${t}"`)}setTimeout(fetchJson,400)}function pushClick(e,t){if(isittime=0===t?1:0,0===t&&playSound(1e3),e.includes("?")){const n=e.split("?")[1],s=`${cmD}gpio,${n},${t}`;getUrl(unitNr===unitNr1?s:`${cmD}SendTo,${nNr},"${s}"`)}else if(e.includes("&")){const[n,s]=e.split("&");getUrl(`${cmD}SendTo,${s},"event,${n}Event=${t}"`)}else{const n=`${cmD}event,${e}Event=${t}`;getUrl(unitNr===unitNr1?n:`${cmD}SendTo,${nNr},"${n}"`)}}function getInput(e,t){if("click"===event.type&&(isittime=0,iIV=setTimeout(blurInput,8e3),e.addEventListener("blur",(e=>{clearTimeout(iIV),isittime=1,setTimeout(fetchJson,400)}))),e.value.length>12&&(e.value=e.value.slice(0,12)),"Enter"===event.key||"click"===event.type&&!t){if(isittime=1,e.value){playSound(4e3);const t=`taskvalueset,${e.classList[1]},${e.value}`;getUrl(unitNr===unitNr1?cmD+t:`${cmD}SendTo,${nNr},"${t}"`),buttonClick(e.id)}else setTimeout(fetchJson,400);clearTimeout(iIV)}else"Escape"===event.key?document.getElementById(e.id).value="":(clearTimeout(iIV),iIV=setTimeout(blurInput,5e3))}function blurInput(){isittime=1}function openNav(e){navOpen=1,e&&(manNav=1),clearInterval(nIV),nIV=setInterval(getNodes,1e4);const t=document.getElementById("mySidenav");-280!==t.offsetLeft||window.configMode?closeNav():(getNodes(),t.style.left="0")}function closeNav(){manNav=0,navOpen=0,clearInterval(nIV),document.getElementById("mySidenav").style.left="-280px"}function openSys(){0===document.getElementById("sysInfo").offsetHeight?(document.getElementById("menueWrap1").style.flexShrink="0",document.getElementById("sysInfo").style.height="180px"):(document.getElementById("sysInfo").style.height="0",document.getElementById("menueWrap1").style.flexShrink="999")}async function getNodes(e,t,n){let s="",i=-1;if(n||(response=await getUrl("/json"),myJson2=await response.json()),myJson2&&(myJson2.nodes.forEach((n=>{if(i++,n.nr==myParam&&hasParams&&(nodeChange(i),hasParams=0),styleN=n.nr===unitNr1?n.nr===unitNr?"&#8857;&#xFE0E;":"&#8858;&#xFE0E;":n.nr===unitNr?"&#183;&#xFE0E;":"",s+=`\n            <div class="menueItem">\n                <div class="serverUnit" style="text-align: center;">${styleN}</div>\n                <div id="${n.name}" class="nc" onclick="nodeChange(${i});iFr();">${n.name}<span class="numberUnit">${n.nr}</span>\n                </div>\n            </div>`,e||t){const s=t?"Long":"Event";getUrl(n.nr===unitNr1?`${cmD}event,${e}${s}`:`${cmD}SendTo,${n.nr},"event,${e}${s}"`)}})),i=0,document.getElementById("menueList").innerHTML=s,hasParams)){let e='<div class="sensorset clickables"><div  class="sensors" style="font-weight:bold;">can not find node # '+myParam+"...</div></div>";document.getElementById("sensorList").innerHTML=e,hasParams=0,setTimeout(fetchJson,3e3)}}function nodeChange(e){const t=myJson2.nodes[e];cD=[],isMain||(runonce2=!0),selectionData={},jStats=!1,window.efc&&exitConfig(),t&&(nNr=t.nr,nN=t.name,baseUrl=`http://${t.ip}`,nP=`${baseUrl}/tools`,nP2=`${baseUrl}/devices`,jsonPath=`${baseUrl}/json`,window.history.replaceState(null,null,`?unit=${nNr}`),newFJ(nN)),window.innerWidth<450&&0===document.getElementById("sysInfo").offsetHeight&&closeNav()}function resizeText(){const e=({clientWidth:e,clientHeight:t,scrollWidth:n,scrollHeight:s})=>n>e||s>t;(({element:t,elements:n,minSize:s=10,maxSize:i=115,step:o=1,unit:l="pt"})=>{(n||[t]).forEach((t=>{let n=s,a=!1;const r=t.parentNode;for(;!a&&n<i;)t.style.fontSize=`${n}${l}`,a=e(r),a||(n+=o);t.style.fontSize=`${n-o-1}${l}`,t.style.lineHeight="0.75"}))})({elements:document.querySelectorAll(".valueBig"),step:1})}function launchFs(e){e.requestFullscreen()}function splitOn(e){const t=document.getElementById("framie");0===t.offsetWidth?(iO=1,iFr(e),t.style.width="100%"):(iO=0,t.style.width=0,t.innerHTML="")}function iFr(e){if(iO){const t=e?`${nP2}?index=${e}&page=1`:nP2;document.getElementById("framie").innerHTML=`<iframe src="${t}"></iframe>`,closeNav()}}function topF(){document.body.scrollTop=0,document.documentElement.scrollTop=0}const longPressN=()=>document.getElementById("mOpen").addEventListener("long-press",(()=>configMode?null:window.location.href=nP));function longPressS(){document.body.addEventListener("long-press",(function(e){e.preventDefault();const t={closeBtn:"Snd",openSys:"Two",unitId:"Col"};t[e.target.id]&&mC(t[e.target.id])}))}function mC(e){const t=1==(document.cookie.match(`(^|;)\\s*${e}\\s*=\\s*([^;]+)`)?.pop()||"");playSound(t?500:900),document.cookie=`${e}=${t?0:1}; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/; SameSite=Lax;`}function longPressB(){setLongPressDelay(600);document.querySelectorAll(".clickables").forEach((e=>{e.addEventListener("long-press",(async function(t){t.preventDefault();const n=e.querySelector(".sensors"),s=e.querySelector(".nodes");let i;if(s)getNodes(s.textContent,"1");else{const[e,t]=n.id.split("&"),s=n.id.split(">")[1];i=t?s&&s.endsWith("L")?`${cmD}SendTo,${t},"GPIOToggle,${s.split("L")[0]}"`:`${cmD}SendTo,${t},"event,${e}Long"`:unitNr===unitNr1?`${cmD}event,${n.id}Long`:`${cmD}SendTo,${nNr},"event,${n.id}Long"`,await getUrl(i),setTimeout(fetchJson,400)}playSound(1e3),isittime=0,iIV=setTimeout(blurInput,600)}))}))}function minutesToDhm(e){const t=Math.floor(e/1440),n=Math.floor(e%1440/60),s=e%60,i=(e,t)=>e>0?`${e} ${t}${1===e?"":"s"} `:"";return i(t,"day")+i(n,"hour")+i(s,"minute")}function playSound(e){500===e?receiveNote("R"):e>=900&&e<=1e3?receiveNote("Y"):e>1e3&&receiveNote("G"),(document.cookie.includes("Snd=1")||e<1e3)&&(isittime||3e3!==e)&&(c=new AudioContext,o=c.createOscillator(),g=c.createGain(),frequency=e,o.frequency.value=frequency,o.type="sawtooth",o.connect(g),g.connect(c.destination),g.gain.setValueAtTime(.05,0),o.start(0),g.gain.exponentialRampToValueAtTime(1e-5,c.currentTime+.01),o.stop(c.currentTime+.01))}async function getUrl(e,t={}){if(!window.configMode||e.includes("/json")){const n=t.controller||new AbortController,s=n.signal;let i=!1;setTimeout((()=>{s.aborted||(i=!0,n.abort())}),1e3);try{return await fetch(e,{...t,signal:s})}catch(e){("AbortError"!==e.name||i)&&receiveNote("R")}}}async function getEfcData(){try{let e=await getUrl("/main_efc.json.gz");if(!e?.ok)throw new Error("main_efc.json not available");efcArray=await e.json()}catch(e){try{let e=await getUrl(`${baseUrl}/efc.json.gz`);if(!e?.ok)throw new Error("efc.json not available");selectionData=await e.json(),isMain=!1}catch(e){e.name}}runonce2=!1}function getEfcUnitData(e){efcArray&&(selectionData=structuredClone(efcArray.find((t=>t.unit===e)))),selectionData||(selectionData={unit:e})}function newFJ(e){fetchAbort?.abort(),clearTimeout(fJ),fetchJson(e),fJ=setInterval(fetchJson,2e3)}function receiveNote(e){const t={G:"rgb(0, 255, 0)",Y:"rgb(255, 251, 0)",R:"rgb(255, 0, 0)",N:"none"};document.getElementById("unitId").style.boxShadow=0===e||"N"===e?t.N:"inset 0px 11px 17px -11px "+t[e],e&&setTimeout((()=>receiveNote(0)),300)}document.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState?newFJ():clearTimeout(fJ)}));const favicon=document.querySelector("link[rel='icon']").getAttribute("href"),manifest={name:"easyfetch",short_name:"ef",display:"standalone",background_color:"#000",theme_color:"#000",icons:[192,256,384,512,57,72,76,120,152,167,180,1024].map((e=>({src:favicon,sizes:`${e}x${e}`,purpose:"any"})))},link=document.createElement("link");if(link.rel="manifest",link.href=URL.createObjectURL(new Blob([JSON.stringify(manifest)],{type:"application/json"})),document.head.appendChild(link),"serviceWorker"in navigator){const e='\n      self.addEventListener("fetch", e => {\n        e.respondWith(\n          fetch(e.request).catch(() =>\n            new Response("Offline", { status: 503 })\n          )\n        );\n      });\n    ';navigator.serviceWorker.register("data:application/javascript,"+encodeURIComponent(e))}window.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),e.prompt?.()})),function(e,t){"use strict";let n=null;let s={x:0,y:0},i=1e3;const o="ontouchstart"in e||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,l="PointerEvent"in e||e.navigator&&"msPointerEnabled"in e.navigator?{down:"pointerdown",up:"pointerup",move:"pointermove",leave:"pointerleave"}:o?{down:"touchstart",up:"touchend",move:"touchmove",leave:"touchleave"}:{down:"mousedown",up:"mouseup",move:"mousemove",leave:"mouseleave"};function a(e){c();const n=r(e),s=new CustomEvent("long-press",{bubbles:!0,cancelable:!0,detail:(i=n,{clientX:i.clientX,clientY:i.clientY,offsetX:i.offsetX,offsetY:i.offsetY,pageX:i.pageX,pageY:i.pageY,screenX:i.screenX,screenY:i.screenY})});var i;this.dispatchEvent(s)||t.addEventListener("click",d,!0)}function r(e){return e.changedTouches?e.changedTouches[0]:e}function c(){n&&(clearTimeout(n),n=null)}function d(e){t.removeEventListener("click",d,!0),e.preventDefault(),e.stopImmediatePropagation()}t.addEventListener(l.down,(function(e){const t=r(e);s={x:t.clientX,y:t.clientY},function(e,t=i){c();const s=e.target;n=setTimeout((()=>a.call(s,e)),t)}(e)}),!0),t.addEventListener(l.move,(function(e){const t=r(e);(Math.abs(s.x-t.clientX)>10||Math.abs(s.y-t.clientY)>10)&&c()}),!0),t.addEventListener(l.up,c,!0),t.addEventListener(l.leave,c,!0),t.addEventListener("wheel",c,!0),t.addEventListener("scroll",c,!0),navigator.userAgent.toLowerCase().includes("android")||t.addEventListener("contextmenu",c,!0),e.setLongPressDelay=function(e){i=e}}(window,document);